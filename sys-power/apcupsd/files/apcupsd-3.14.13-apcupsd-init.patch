From 2d2267e5854b0b6873d1ed1915cfd0ab72363e69 Mon Sep 17 00:00:00 2001
From: joe9 <joe9mail@gmail.com>
Date: Fri, 13 Nov 2015 18:28:11 -0500
Subject: [PATCH 2/2] changed to use configure parameters

---
 platforms/gentoo/Makefile        |  2 +-
 platforms/gentoo/apcupsd.in | 55 ++++++++++++++++++++++++++++++++++++++++
 2 files changed, 56 insertions(+), 1 deletion(-)
 create mode 100644 platforms/gentoo/apcupsd.in

diff --git a/platforms/gentoo/Makefile b/platforms/gentoo/Makefile
index 879ccda..9bf4ed3 100644
--- a/platforms/gentoo/Makefile
+++ b/platforms/gentoo/Makefile
@@ -9,7 +9,7 @@ all-uninstall: uninstall-gentoo
 install-gentoo:
 	$(call DISTINST,gentoo)
 	$(call MKDIR,/etc/init.d)
-	$(call INSTPROG,744,apcupsd,/etc/init.d/apcupsd)
+	$(call INSTPROG,744,apcupsd.init,/etc/init.d/apcupsd)
 	$(call INSTPROG,744,halt,/etc/init.d/halt)
 
 uninstall-gentoo:
diff --git a/platforms/gentoo/apcupsd.in b/platforms/gentoo/apcupsd.in
new file mode 100644
index 0000000..2dcab44
--- /dev/null
+++ b/platforms/gentoo/apcupsd.in
@@ -0,0 +1,55 @@
+#!/sbin/runscript
+# Copyright 1999-2013 Gentoo Foundation
+# Distributed under the terms of the GNU General Public License v2
+# $Id$
+
+INSTANCE="${SVCNAME#*.}"
+if [ -z "${INSTANCE}" ] || [ "${SVCNAME}" = "apcupsd" ]; then
+    INSTANCE="apcupsd"
+fi
+
+dir=@PIDDIR@
+
+depend() {
+    use net
+}
+
+start_pre() {
+    checkpath -d -m 0775 -o root:uucp @PIDDIR@
+}
+
+start() {
+    export SERVICE="${SVCNAME}"
+
+    if [ ! -d "@PIDDIR@" ]; then
+        einfo " Creating @PIDDIR@"
+        /bin/mkdir -p "@PIDDIR@"
+        /bin/chown root:uucp "@PIDDIR@"
+    fi
+
+    if [ ! -d "@PWRFAILDIR@" ]; then
+        einfo " Creating @PWRFAILDIR@"
+        /bin/mkdir -p "@PWRFAILDIR@"
+        /bin/chown root:uucp "@PWRFAILDIR@"
+    fi
+
+    rm --force @PWRFAILDIR@/powerfail
+
+    ebegin "Starting APC UPS daemon"
+    start-stop-daemon \
+        --start --pidfile "@PIDDIR@/${SVCNAME}.pid" \
+        --exec /sbin/apcupsd -- \
+        -f "@sysconfdir@/${INSTANCE}.conf" \
+        -P "@PIDDIR@/${SVCNAME}.pid"
+    eend $?
+}
+
+stop() {
+    ebegin "Stopping APC UPS daemon"
+    start-stop-daemon \
+        --stop --pidfile "@PIDDIR@/${SVCNAME}.pid" \
+        --retry TERM/5/TERM/5 \
+        --exec /sbin/apcupsd
+    eend $?
+}
+
--
2.4.10

